<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PointerLockControls</title>
    <meta name="description" content="Exemplo de uso de Three.js e PointerLockControls.">
    <link type="text/css" rel="stylesheet" href="estilo.css" />
    <script type="importmap">
            {
                "imports": {
                    "three": "../assetsv5/js/three.module.js",
                    "PointerLockControls": "../assetsv5/js/PointerLockControls.js"
                }
            }
    </script>
</head>

<body>
    <div id="overlay">
        <div class="icon-button" id="startButton" title="Clique para capturar o mouse">
            <div class="mouse-icon">üñ±Ô∏è</div>
        </div>
        <div class="hint">
            Clique no mouse para iniciar.<br />
            Use <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> para andar ‚Ä¢ <kbd>Esc</kbd> para sair
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'PointerLockControls';

        const scene = new THREE.Scene()
        var light = new THREE.AmbientLight()
        scene.add(light)
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000)
        const renderer = new THREE.WebGLRenderer()
        renderer.setSize(window.innerWidth, window.innerHeight)
        document.body.appendChild(renderer.domElement)
        const menuPanel = document.getElementById('overlay')
        const startButton = document.getElementById('startButton')
        startButton.addEventListener(
            'click',
            function () {
                controls.lock()
            },
            false
        )
        const controls = new PointerLockControls(camera, renderer.domElement)

        controls.addEventListener('lock', () => (menuPanel.style.display = 'none'))
        controls.addEventListener('unlock', () => (menuPanel.style.display = 'block'))

        const planeGeometry = new THREE.PlaneGeometry(100, 100, 50, 50)
        const material = new THREE.MeshBasicMaterial({ color: 0x00ff00, wireframe: true })
        const plane = new THREE.Mesh(planeGeometry, material)
        plane.rotateX(-Math.PI / 2)
        scene.add(plane)

        let cubes = new Array() // array para guardar os cubos

        function intCenarioAleatorio() {
            for (let i = 0; i < 100; i++) {
                const geo = new THREE.BoxGeometry(Math.random() * 4, Math.random() * 16, Math.random() * 4)
                const mat = new THREE.MeshBasicMaterial({ wireframe: true })
                switch (i % 3) {
                    case 0:
                        mat.color = new THREE.Color(0xff0000)
                        break
                    case 1:
                        mat.color = new THREE.Color(0xffff00)
                        break
                    case 2:
                        mat.color = new THREE.Color(0x0000ff)
                        break
                }
                const cube = new THREE.Mesh(geo, mat)
                cubes.push(cube)
            }
            cubes.forEach((c) => {
                c.position.x = Math.random() * 100 - 50
                c.position.z = Math.random() * 100 - 50
                c.geometry.computeBoundingBox()
                c.position.y = (c.geometry.boundingBox.max.y - c.geometry.boundingBox.min.y) / 2
                scene.add(c)
            })
        }
        intCenarioAleatorio();

        // Posi√ß√£o inicial da c√¢mera
        camera.position.y = 1
        camera.position.z = 2

        const keyMap = {}
        const onDocumentKey = (e) => {
            keyMap[e.code] = e.type === 'keydown'
        }

        document.addEventListener('keydown', onDocumentKey, false)
        document.addEventListener('keyup', onDocumentKey, false)

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight
            camera.updateProjectionMatrix()
            renderer.setSize(window.innerWidth, window.innerHeight)
            render()
        }
        window.addEventListener('resize', onWindowResize, false)

        function animate() {
            requestAnimationFrame(animate)
            //controls.update()
            if (keyMap['KeyW'] || keyMap['ArrowUp']) {
                controls.moveForward(0.25)
            }
            if (keyMap['KeyS'] || keyMap['ArrowDown']) {
                controls.moveForward(-0.25)
            }
            if (keyMap['KeyA'] || keyMap['ArrowLeft']) {
                controls.moveRight(-0.25)
            }
            if (keyMap['KeyD'] || keyMap['ArrowRight']) {
                controls.moveRight(0.25)
            }
            render()
        }

        function render() {
            renderer.render(scene, camera)
        }

        animate()
    </script>


</body>

</html>